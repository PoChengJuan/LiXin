{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Documents/React/workspace/src/FrontEnd/Container/User.js\";\nimport React from 'react';\nimport './User.css';\nimport { Row, Col, Layout, Button } from 'antd';\nimport { List, Icon, Popover, Avatar, InputNumber, notification } from 'antd';\nimport axios from 'axios';\nimport NumericInput from '../Components/InputNumber';\nimport { BrowserRouter as Router, Redirect } from \"react-router-dom\";\nimport moment from 'moment';\nimport baseURL from '../Components/AxiosAPI';\nconst Header = Layout.Header,\n      Content = Layout.Content;\n\nconst openNotificationWithIcon = type => {\n  notification[type]({\n    message: '上傳成功'\n  });\n};\n/*const User = (\n  <div>\n    <p>姓名：</p>\n    <p>位置：康樂總店</p>\n    <p>人員：開發者</p>\n  </div>\n);*/\n//var expense =[\n// '支出'\n//];\n\n\nvar income = ['營業額'];\n\nclass UserPage extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.StockValueStore = (item, Num) => {\n      const data = this.state.data;\n      console.log('===', Num);\n      data.forEach(data => {\n        if (data.key === item.key) {\n          data.stock = Num;\n        }\n      });\n      this.setState({\n        data\n      });\n    };\n\n    this.OrderValueStore = (item, Num) => {\n      const data = this.state.data;\n      console.log('order:', Num);\n      data.forEach(data => {\n        if (data.key === item.key) {\n          data.order = Num;\n        }\n      });\n      this.setState({\n        data\n      });\n    };\n\n    this.ExpenseValueStore = (item, Num) => {};\n\n    this.IncomStore = income => {\n      this.setState({\n        Income: income\n      });\n    };\n\n    this.ExpenseStore = expense => {\n      this.setState({\n        Expense: expense\n      });\n    };\n\n    this.state = {\n      isAuth: '',\n      UploadDisable: true,\n      data: '',\n      expense: '',\n      Income: '',\n      Shop: '',\n      Name: '',\n      Branch: '',\n      Permission: '',\n      Position: ''\n    };\n  }\n\n  LogoutFunction() {\n    this.setState({\n      isAuth: 'false'\n    });\n    window.sessionStorage.setItem('isAuth', 'false');\n  }\n\n  render() {\n    const _this$state = this.state,\n          data = _this$state.data,\n          expense = _this$state.expense,\n          isAuth = _this$state.isAuth;\n\n    if (isAuth === 'false') {\n      console.log('logout');\n      return React.createElement(Redirect, {\n        to: '/',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84\n        },\n        __self: this\n      });\n    }\n\n    return React.createElement(\"div\", {\n      className: \"App\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87\n      },\n      __self: this\n    }, React.createElement(Row, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }, React.createElement(Layout, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }, React.createElement(Col, {\n      span: 24,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90\n      },\n      __self: this\n    }, React.createElement(Header, {\n      className: \"Header\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91\n      },\n      __self: this\n    }, React.createElement(Popover, {\n      content: React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93\n        },\n        __self: this\n      }, //User\n      React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97\n        },\n        __self: this\n      }, \"\\u59D3\\u540D\\uFF1A\", this.state.Name), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98\n        },\n        __self: this\n      }, \"\\u4F4D\\u7F6E\\uFF1A\", this.state.Branch), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99\n        },\n        __self: this\n      }, \"\\u6B0A\\u9650\\uFF1A\", this.state.Position)), React.createElement(Button, {\n        className: \"logout\",\n        onClick: this.LogoutFunction.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102\n        },\n        __self: this\n      }, \"\\u767B\\u51FA\", React.createElement(Icon, {\n        type: \"logout\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102\n        },\n        __self: this\n      }))),\n      trigger: \"click\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92\n      },\n      __self: this\n    }, React.createElement(Avatar, {\n      className: \"Avatar\",\n      shape: \"circle\",\n      icon: \"user\",\n      size: 60,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    })))), React.createElement(Col, {\n      span: 24,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109\n      },\n      __self: this\n    }, React.createElement(Content, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"Content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"ListName\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112\n      },\n      __self: this\n    }, React.createElement(List, {\n      bordered: true,\n      dataSource: data,\n      renderItem: item => React.createElement(List.Item, {\n        key: item.key,\n        actions: [React.createElement(InputNumber, {\n          key: item.key,\n          className: \"Number\",\n          value: item.stock,\n          onChange: value => this.StockValueStore(item, value),\n          defaultValue: \"0\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 118\n          },\n          __self: this\n        }), React.createElement(InputNumber, {\n          key: item.key,\n          className: \"Order\",\n          value: item.order,\n          placeholder: \"\\u53EB\\u8CA8\",\n          onChange: value => this.OrderValueStore(item, value),\n          decimalSeparator: \".\",\n          defaultValue: \"0\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 119\n          },\n          __self: this\n        })],\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117\n        },\n        __self: this\n      }, item.title),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113\n      },\n      __self: this\n    }), React.createElement(List, {\n      bordered: true,\n      dataSource: expense,\n      renderItem: item => //<List.Item actions={[<NumericInput style={{ width: 130 }} addonBefore={'NTD:'} value={this.state.Expense} onChange={(value)=>this.ExpenseStore(value)}  />]}>\n      // {'支出'} \n      //</List.Item>\n      React.createElement(List.Item, {\n        key: item.key,\n        actions: [React.createElement(NumericInput, {\n          style: {\n            width: 130\n          },\n          key: item.key,\n          addonBefore: 'NTD:',\n          value: item.cost,\n          onChange: value => this.ExpenseValueStore(item, value),\n          defaultValue: \"0\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 133\n          },\n          __self: this\n        }) //<InputNumber key={item.key} className=\"Number\" value={item.cost} onChange={(value) => this.ExpenseValueStore(item,value)} defaultValue='0'/>\n        ],\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      }, item.title),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }), React.createElement(List, {\n      bordered: true,\n      dataSource: income,\n      renderItem: item => React.createElement(List.Item, {\n        actions: [React.createElement(NumericInput, {\n          style: {\n            width: 130\n          },\n          addonBefore: 'NTD:',\n          value: this.state.Income,\n          onChange: value => this.IncomStore(value),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 145\n          },\n          __self: this\n        })],\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145\n        },\n        __self: this\n      }, '營業額'),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141\n      },\n      __self: this\n    })), React.createElement(Button, {\n      type: \"primary\",\n      className: \"Upload\",\n      disabled: this.state.UploadDisable,\n      onClick: this.UploadFunction.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151\n      },\n      __self: this\n    }, \"\\u4E0A\\u50B3\")))))));\n  }\n\n  UploadFunction(event) {\n    console.log(this.state.Shop);\n    axios.post(baseURL + '/ShopData/add', {\n      name: this.state.Shop,\n      branch: this.state.Branch,\n      date: moment().format('YYYY-MM-DD hh:mm'),\n      stock: this.state.data,\n      expense: this.state.Expense,\n      income: this.state.Income\n    }).then(response => {\n      console.log(response);\n      this.setState({\n        UploadDisable: true\n      });\n      console.log('success');\n      window.sessionStorage.setItem('lastupload', moment().format('YYYY-MM-DD'));\n      openNotificationWithIcon('success'); //set last upload date\n\n      axios.put(baseURL + '/User/updateUploaddate/' + window.sessionStorage.getItem('auto_increment'), {\n        date: moment().format('YYYY-MM-DD')\n      }).then(response => {\n        console.log(response);\n      }).catch(error => {\n        console.log(error);\n      });\n    }).catch(function (error) {\n      console.log(error);\n    });\n  }\n\n  componentWillMount() {\n    console.log('componentWillMount');\n    axios.get(baseURL + '/ShopData/getLastStock', {\n      params: {\n        shop: window.localStorage.getItem('shopname'),\n        branch: window.localStorage.getItem('branch')\n      }\n    }).then(response => {\n      for (var index in response.data) {\n        response.data[index].order = 0;\n      }\n\n      this.setState({\n        data: response.data,\n        Shop: window.localStorage.getItem('shopname'),\n        Name: window.localStorage.getItem('name'),\n        Branch: window.localStorage.getItem('branch'),\n        isAuth: window.sessionStorage.getItem('isAuth'),\n        Permission: window.sessionStorage.getItem('permission')\n      });\n\n      if (window.sessionStorage.getItem('permission') === '9') {\n        this.setState({\n          Position: '開發者'\n        });\n      } else if (window.sessionStorage.getItem('permission') === '7') {\n        this.setState({\n          Position: '老闆'\n        });\n      } else if (window.sessionStorage.getItem('permission') === '5') {\n        this.setState({\n          Position: '店長'\n        });\n      } else {\n        this.setState({\n          Position: '人員'\n        });\n      }\n    }).catch(function (error) {\n      console.log(error);\n    });\n    axios.get(baseURL + '/ShopData/getExpense', {\n      params: {\n        shop: window.localStorage.getItem('shopname'),\n        branch: window.localStorage.getItem('branch')\n      }\n    }).then(response => {\n      for (var index in response.data) {\n        response.data[index].cost = 0;\n      }\n\n      this.setState({\n        expense: response.data\n      });\n    }).catch(function (error) {\n      console.log(error);\n    }); //console.log(window.sessionStorage.getItem('date'))\n    //console.log(moment().format('MM-DD'))\n    //One day only upload one time\n    //Upload Function only enable in 4pm ~ 5pm\n\n    console.log(window.sessionStorage.getItem('lastupload'));\n    console.log(moment().format('YYYY-MM-DD')); //if(window.sessionStorage.getItem('isupload') === 'false'){\n\n    if (window.sessionStorage.getItem('lastupload') !== moment().format('YYYY-MM-DD')) {\n      if (moment().format('hh a') === '04 pm' || moment().format('hh a') === '02 am') {\n        this.setState({\n          UploadDisable: false\n        });\n      }\n    } //if(window.sessionStorage.getItem('uploadagain') === 'true'){\n    //  this.setState({UploadDisable:false});\n    //}\n\n  }\n\n  componentDidMount() {\n    console.log('componentdDidMount');\n    console.log(moment().format('YYYY-MM-DD hh:mm'));\n  }\n\n  componentDidUpdate() {\n    console.log('componentDidUpdate');\n  }\n\n}\n\nexport default UserPage;","map":{"version":3,"sources":["/Users/mac/Documents/React/workspace/src/FrontEnd/Container/User.js"],"names":["React","Row","Col","Layout","Button","List","Icon","Popover","Avatar","InputNumber","notification","axios","NumericInput","BrowserRouter","Router","Redirect","moment","baseURL","Header","Content","openNotificationWithIcon","type","message","income","UserPage","Component","constructor","props","StockValueStore","item","Num","data","state","console","log","forEach","key","stock","setState","OrderValueStore","order","ExpenseValueStore","IncomStore","Income","ExpenseStore","expense","Expense","isAuth","UploadDisable","Shop","Name","Branch","Permission","Position","LogoutFunction","window","sessionStorage","setItem","render","bind","value","title","width","cost","UploadFunction","event","post","name","branch","date","format","then","response","put","getItem","catch","error","componentWillMount","get","params","shop","localStorage","index","componentDidMount","componentDidUpdate"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './User.css'\nimport { Row, Col, Layout, Button } from 'antd';\nimport { List, Icon, Popover, Avatar, InputNumber,notification } from 'antd';\nimport axios from 'axios'\nimport NumericInput from'../Components/InputNumber'\nimport {BrowserRouter as Router,Redirect,} from \"react-router-dom\";\nimport moment from 'moment';\nimport baseURL from '../Components/AxiosAPI'\nconst { Header, Content } = Layout;\n\nconst openNotificationWithIcon = type => {\n  notification[type]({\n    message: '上傳成功',\n  });\n};\n\n/*const User = (\n  <div>\n    <p>姓名：</p>\n    <p>位置：康樂總店</p>\n    <p>人員：開發者</p>\n  </div>\n);*/\n//var expense =[\n // '支出'\n//];\nvar income = [\n  '營業額'\n];\nclass UserPage extends React.Component{\n  constructor(props){\n    super(props);\n    this.state = {\n      isAuth: '',\n      UploadDisable:true,\n      data:'',\n      expense:'',\n      Income:'',\n      Shop:'',\n      Name:'',\n      Branch:'',\n      Permission:'',\n      Position:''\n    }      \n  }\n  LogoutFunction(){\n    this.setState({isAuth:'false'});\n    window.sessionStorage.setItem('isAuth','false');\n  }\n  StockValueStore  = (item ,Num) => {\n    const {data} = this.state;\n    console.log('===', Num);\n      data.forEach(data => {\n      if (data.key === item.key) {\n        data.stock = Num;\n      }\n    });\n    this.setState({ data });\n  }\n  OrderValueStore = (item, Num)=>{\n    const {data} = this.state;\n    console.log('order:',Num);\n    data.forEach(data=>{\n      if(data.key === item.key){\n        data.order = Num\n      }\n    })\n    this.setState({ data });\n  }\n  ExpenseValueStore = (item, Num) => {\n\n  }\n  IncomStore = (income) =>{\n    this.setState({Income:income})\n  }\n  ExpenseStore = (expense) => {\n    this.setState({Expense:expense})\n  }\n  render(){\n    const { data,expense,isAuth } = this.state;\n    if(isAuth === 'false'){\n      console.log('logout');\n      return <Redirect to={'/'} />\n    }    \n    return(\n      <div className=\"App\">\n        <Row>\n          <Layout>\n            <Col span={24}>\n              <Header className=\"Header\">\n                <Popover content={\n                  <div>\n                    {\n                      //User\n                      <div>\n                        <p>姓名：{this.state.Name}</p>\n                        <p>位置：{this.state.Branch}</p>\n                        <p>權限：{this.state.Position}</p>\n                      </div>\n                    }\n                    <Button className='logout' onClick={this.LogoutFunction.bind(this)}>登出<Icon type=\"logout\" /></Button>\n                  </div>\n                } trigger=\"click\">\n                  <Avatar className=\"Avatar\" shape=\"circle\" icon=\"user\" size={60} />    \n                </Popover>\n              </Header>\n            </Col>\n            <Col span={24}>\n              <Content>\n                <div className=\"Content\">\n                  <div className=\"ListName\">\n                    <List \n                      bordered\n                      dataSource={data}\n                      renderItem={item => (\n                        <List.Item key={item.key} actions={\n                          [<InputNumber key={item.key} className=\"Number\" value={item.stock} onChange={(value) => this.StockValueStore(item,value)} defaultValue='0'/>,\n                          <InputNumber key={item.key} className=\"Order\" value={item.order} placeholder=\"叫貨\" onChange={(value)=>this.OrderValueStore(item,value)} decimalSeparator=\".\" defaultValue=\"0\" />]\n                          }>\n                          {item.title}\n                        </List.Item>\n                      )}\n                    />\n                    <List\n                      bordered\n                      dataSource={expense}\n                      renderItem={item=>(\n                        //<List.Item actions={[<NumericInput style={{ width: 130 }} addonBefore={'NTD:'} value={this.state.Expense} onChange={(value)=>this.ExpenseStore(value)}  />]}>\n                         // {'支出'} \n                        //</List.Item>\n                        <List.Item key={item.key} actions={\n                          [<NumericInput style={{ width: 130 }} key={item.key} addonBefore={'NTD:'} value={item.cost} onChange={(value) => this.ExpenseValueStore(item,value)} defaultValue='0' />\n                          //<InputNumber key={item.key} className=\"Number\" value={item.cost} onChange={(value) => this.ExpenseValueStore(item,value)} defaultValue='0'/>\n                        ]\n                          }>\n                          {item.title}\n                        </List.Item>\n                      )}\n                    />\n                    <List\n                      bordered\n                      dataSource={income}\n                      renderItem={item=>(\n                        <List.Item actions={[<NumericInput style={{ width: 130 }} addonBefore={'NTD:'} value={this.state.Income} onChange={(value)=>this.IncomStore(value)}  />]}>\n                          {'營業額'} \n                        </List.Item>\n                      )}\n                    />\n                  </div>\n                  <Button type=\"primary\" className=\"Upload\" disabled = {this.state.UploadDisable} onClick={this.UploadFunction.bind(this)}>上傳</Button>\n                </div>\n              </Content>\n            </Col>\n          </Layout>\n        </Row>\n      </div>\n    )\n  }\n  UploadFunction(event){\n    console.log(this.state.Shop)\n    axios.post(baseURL+'/ShopData/add', {\n      name: this.state.Shop,\n      branch : this.state.Branch,\n      date:moment().format('YYYY-MM-DD hh:mm'),\n      stock:this.state.data,\n      expense:this.state.Expense,\n      income:this.state.Income\n    })\n    .then( (response) => {\n      console.log(response);\n      this.setState({UploadDisable:true})\n      console.log('success')\n      window.sessionStorage.setItem('lastupload',moment().format('YYYY-MM-DD'));\n      openNotificationWithIcon('success')\n      \n      //set last upload date\n      axios.put(baseURL+'/User/updateUploaddate/'+window.sessionStorage.getItem('auto_increment'),{\n        date:moment().format('YYYY-MM-DD')\n      })\n      .then( (response) => {\n        console.log(response);\n      })\n      .catch( (error) => {\n        console.log(error);\n      });\n    })\n    .catch(function (error) {\n      console.log(error);\n    });\n    \n  }\n\n  componentWillMount() {\n    console.log('componentWillMount');\n      axios.get(baseURL+'/ShopData/getLastStock',\n        {\n          params: {\n            shop : window.localStorage.getItem('shopname'),\n            branch : window.localStorage.getItem('branch')\n          }\n        }\n      )\n      .then( (response) =>{\n      for(var index in response.data){\n        response.data[index].order = 0;\n      }\n      this.setState({data:response.data,\n        Shop:window.localStorage.getItem('shopname'),\n        Name:window.localStorage.getItem('name'),\n        Branch:window.localStorage.getItem('branch'),\n        isAuth:window.sessionStorage.getItem('isAuth'),\n        Permission:window.sessionStorage.getItem('permission')\n      });\n      if(window.sessionStorage.getItem('permission') === '9'){\n        this.setState({Position:'開發者'});\n      }else if(window.sessionStorage.getItem('permission') === '7'){\n        this.setState({Position:'老闆'});\n      }else if(window.sessionStorage.getItem('permission') === '5'){\n        this.setState({Position:'店長'});\n      }else{\n        this.setState({Position:'人員'});\n      }\n    })\n    .catch(function (error) {\n      console.log(error);\n    }); \n\n    axios.get(baseURL+'/ShopData/getExpense',\n    {\n      params: {\n        shop: window.localStorage.getItem('shopname'),\n        branch: window.localStorage.getItem('branch')\n      }\n    })\n    .then( (response) => {\n      for(var index in response.data){\n        response.data[index].cost = 0;\n      }\n      this.setState({expense:response.data});\n    })\n    .catch(function (error) {\n      console.log(error);\n    }); \n    //console.log(window.sessionStorage.getItem('date'))\n    //console.log(moment().format('MM-DD'))\n    //One day only upload one time\n      //Upload Function only enable in 4pm ~ 5pm\n \n    console.log(window.sessionStorage.getItem('lastupload'))\n    console.log(moment().format('YYYY-MM-DD'))\n    //if(window.sessionStorage.getItem('isupload') === 'false'){\n    if(window.sessionStorage.getItem('lastupload') !== moment().format('YYYY-MM-DD')){\n      if((moment().format('hh a')==='04 pm') || (moment().format('hh a')==='02 am')){        \n        this.setState({UploadDisable:false});\n      } \n    }\n    //if(window.sessionStorage.getItem('uploadagain') === 'true'){\n    //  this.setState({UploadDisable:false});\n    //}\n  }\n  componentDidMount(){\n    console.log('componentdDidMount');\n    console.log(moment().format('YYYY-MM-DD hh:mm'))\n  }\n  componentDidUpdate(){\n    console.log('componentDidUpdate');\n  }\n}\n\n\nexport default UserPage;\n"]},"metadata":{},"sourceType":"module"}